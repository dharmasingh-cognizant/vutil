{
  "_vars" : {
    "name" : "vutil",
    "version" : "0.0.1",
    "deftimeout" : 5000,
    "defKey" : "message",
    "supportEmail" : "support@vrest.io",
    "locale":{
      "en":{
        "missingParamMsg":"Parameter `{{0}}` was missing in request.",
        "invalidParamMsg":"Value of parameter `{{0}}` was not valid.",
        "enumErrorMsg":"Value of parameter `{{0}}` must be one of `{{1}}`.",
        "connnotavail":"Connection setup not available. Please notify for connection setup at {{supportEmail}}.",
        "invalidconname":"Please provide a valid connection name.",
        "queryfail" : "Error while executing query. "
      }
    }
  },
  "_root" : {
    "$" : {
      "name" : "{{name}}",
      "version" : "{{version}}"
    },
    "+":{
      "currentLocale" : "en",
      "requestId":{
        "@" : "getRequestId"
      },
      "params":{
        "@" : "getBodyParams"
      }
    },
    "execute":{
      "dbquery":{
        ":conn" : {
          "=":[
            {
              "@" : "isConnAvailable",
              "ifFailed" : {
                "message":"{{locale.{{currentLocale}}.{{conErrorType}}}}",
                "status":400
              }
            },
            {
              "uponEvent" : "body-recieved",
              "@" : "isValidBodyForDB",
              "ifFailed" : {
                "@" : "invalidParamMsg",
                "params": "query"
              }
            }
          ],
          "$post":{
            "uponEvent" : "body-recieved",
            "@":"{{connType}}"
          }
        }
      },
      "command":{
        "=":[
          {
            "uponEvent" : "body-recieved",
            "@":"isStr",
            "params":"{{params.body.command}}",
            "ifFailed" : {
              "@" : "missingParamMsg",
              "params": "command"
            }
          }
        ],
        "$post":{
          "uponEvent" : "body-recieved",
          "@":"cmd"
        }
      }
    },
    "convert":{
      "csv":{
        "json":{
          "=":[
            {
              "uponEvent":"body-recieved",
              "@":"isStr",
              "params":"{{params.body.filePath}}",
              "ifFailed":{
                "@" : "missingParamMsg",
                "params": "filePath"
              }
            }
          ],
          "$post":{
            "uponEvent" : "body-recieved",
            "@":"csvtojson"
          }
        }
      }
    },
    "request":{
      "=":[
        {
          "uponEvent":"body-recieved",
          "@" : "isStr",
          "params": "{{params.body.method}}",
          "ifFailed":{
            "@" : "missingParamMsg",
            "params": "method"
          }
        },
        {
          "uponEvent":"body-recieved",
          "@" : "isStr",
          "params": "{{params.body.url}}",
          "ifFailed":{
            "@" : "missingParamMsg",
            "params": "url"
          }
        }
      ],
      "$post":{
        "uponEvent" : "body-recieved",
        "@" : "fireRequest"
      }
    }
  }
}
